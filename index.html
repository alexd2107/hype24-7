<!-- Shop Section -->
<section id="shop">
  <h2>Our Inventory</h2>

  <div class="controls">
    <input type="text" id="search" placeholder="Search sneakers...">
    <select id="sizeFilter">
      <option value="">All Sizes</option>
    </select>
    <select id="priceFilter">
      <option value="">All Prices</option>
      <option value="0-200">$0 - $200</option>
      <option value="200-400">$200 - $400</option>
      <option value="400-600">$400 - $600</option>
      <option value="600+">$600+</option>
    </select>
  </div>

  <div class="grid" id="inventory"></div>
</section>

<script>
  let inventoryData = [];
  
  async function loadInventory() {
    // âœ… Your published Google Sheets link
    const url = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRNR2S9ChRZ0QgYCH4EpAUK7KyVP-VwS4tTQhChdsGkA7h0sQNj0fjNvj-tDiAre66zzY6hIsKAdB-1/pub?output=csv";
    const response = await fetch(url);
    const data = await response.text();
    const rows = data.split("\n").map(r => r.split(","));

    const headers = rows[0];
    inventoryData = rows.slice(1).map(r => {
      let obj = {};
      headers.forEach((h, i) => obj[h.trim().toLowerCase()] = r[i] ? r[i].trim() : "");
      return obj;
    });

    populateSizeFilter();
    renderCards(inventoryData);
  }

  function renderCards(data) {
    let container = document.getElementById("inventory");
    container.innerHTML = "";

    data.forEach(item => {
      if (!item["name"]) return; // skip empty rows

      let card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <h3>${item["name"]}</h3>
        <p>Size: ${item["size"] || "-"}</p>
        <p class="price">${item["price"] || "N/A"}</p>
      `;
      container.appendChild(card);
    });
  }

  function populateSizeFilter() {
    const sizeSet = new Set(inventoryData.map(item => item["size"]));
    const sizeFilter = document.getElementById("sizeFilter");
    sizeSet.forEach(size => {
      if (size) {
        let option = document.createElement("option");
        option.value = size;
        option.textContent = size;
        sizeFilter.appendChild(option);
      }
    });
  }

  function applyFilters() {
    const search = document.getElementById("search").value.toLowerCase();
    const size = document.getElementById("sizeFilter").value;
    const price = document.getElementById("priceFilter").value;

    let filtered = inventoryData.filter(item => {
      let matchesSearch = Object.values(item).some(val => 
        val.toLowerCase().includes(search)
      );

      let matchesSize = size ? item["size"] === size : true;

      let matchesPrice = true;
      if (price && item["price"]) {
        let itemPrice = parseFloat(item["price"].replace(/[^0-9.]/g, ""));
        if (!isNaN(itemPrice)) {
          if (price.includes("+")) {
            matchesPrice = itemPrice >= parseInt(price);
          } else {
            let [min, max] = price.split("-").map(Number);
            matchesPrice = itemPrice >= min && itemPrice <= max;
          }
        }
      }

      return matchesSearch && matchesSize && matchesPrice;
    });

    renderCards(filtered);
  }

  document.getElementById("search").addEventListener("input", applyFilters);
  document.getElementById("sizeFilter").addEventListener("change", applyFilters);
  document.getElementById("priceFilter").addEventListener("change", applyFilters);

  loadInventory();
</script>
